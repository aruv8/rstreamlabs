<!-- обычная таблица. но:
* по клику на ячейке - она выделяется (почитай про установку фокуса, tabindex)
* при двойном клике входишь в режим редактирования ячейки (в ячейке появляется input). 
при клик-ауте из инпута (почитай - событие blur) или нажатии Enter инпут пропадает и его содержимое 
(то, что ты ввёл) записывается в ячейку. почитай про события клавиатуры (keydown, keypress).
никаких onclick=, все события вешай на ячейки с помощью jq. можно повесить на все ячейки одним махом -->

<!DOCTYPE html>
<html>
<head>
	<title>Lab 24 - Excel</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<style type="text/css">
		body {
			min-height: 100%;
			min-width: 500px;
			background-color: #eee;
		}

		#outerdiv4table {
			position: relative;
			margin: 0;
			padding: 0;
			border: 5px solid white;
			width: fit-content;
		}

		table {
			background-color: #e5e5e5;
			user-select: none;
		}
		table, td {
		    border: 1px solid black;
		    border-collapse: collapse;
		}

		td {
		    text-align: left;
		    max-width: 100px;
		    min-width: 100px;
		    height: 20px;
		    overflow: hidden;
		}

		table tr:first-child, td:first-child {
			background-color: #999;
			text-align: center;
		}

		table td:first-child {
			width: 50px;
		}

		input {
			display: fixed;
			position: relative;
			margin: 0;
			padding: 0;
			width: 96%;
			height: 16px;
		}

	</style>
	<script type="text/javascript">
		var i, 
			j;

		/**
		 * The very first initializations
		 */
		initialization = function() {
	    $(function() { 			// $(document).ready(function()
			var $table,			// new table
				$tr,			// new tr
				$td,			// new td
				$outerdiv,		// div for the table
				$tabledata;		// table td's

			generate_table(21, 11);
			listen_event();
	    	});
		};

		/**
		 * Creates a table
		 *@param {integer} rows
		 *@param {integer} tds
		 */
		generate_table = function (rows_num, tds_num) {
			var row_counter = 0;

			$outerdiv = ("#outerdiv4table");
			$table = $("<table>").appendTo($outerdiv);

			for (i = 0; i < rows_num; i++) {
				$tr = $("<tr>").appendTo($table);

				for (j = 0; j < tds_num; j++) {
					$td = $("<td>").appendTo($tr);
				}
			}
			
			//tabindex (makes tds "selectable")
			$("tr:not(:first-child) td:not(:first-child)").attr({"tabindex":"1"})

			// numeration
			$tabledata = $("table td"); 	
			for (j = 1; j < tds_num; j++) {
				$tabledata.eq(j).text(j);
			}
			i = 1;
			for (i = i + tds_num; i < tds_num*rows_num; i = i + tds_num) {
				row_counter++;
				$tabledata.eq(i-1).text(row_counter);
			}
		};
		
		/**
		 * Adds inputs in tds (reads td's value, stores input's value in td)
		 * @param {element} target
		 */	
		editmode = function (target) {
		 	var $input, 	// new input
				cell_value,
				cell_value2;//temporary storage of cell value as it destroyed later

		 	cell_value2 = cell_value = target.text(); // stores td's value twice; 
			target.text(""); // clears text in td to make a room for input
			$input = $("<input>").attr({"type":"text", "value":cell_value}).appendTo(target).focus();
			
			$input.keydown(function (e) {
				switch (e.keyCode) {
					case 13: 	// Enter key
					target.text($input.val()); // writes input value to td
					$input.remove();     		 // destroys input
					break;

					case 27: 	// Escape key
					$input.remove();
					target.text(cell_value2); // "cell_value" doesn't exist
					break;
				}
			});

			$input.on("blur", function() {
				if ($input.val()) {
					target.text($input.val()); 
				}
				$input.remove();     			 
			});
		};


		/**
		 * Catches events on table cells (focus, doubleclick, blur, Enter, Escape)
		 */
		listen_event = function () {
			var $target,	// element in target (td)
				$content;	// tds with tabindex 1

				$content = $("table td[tabindex='1']");

			// Double click
			$content.on("dblclick", function (event) {
				$target = $(event.target);
				editmode($target); 
			});
			
			// Focus and Keypress
			$content.on("keypress", function (event) {
				$target = $(event.target);
				if ($target.focus ()) {
					editmode($target); 
				};
			});
		};
		
		initialization();	
	</script>
</head>
<body>
	<div id="outerdiv4table">
		
	</div>
</body>
</html>